async function forceInputAlphaNumeric(promptMessage) {
  while (true) {
    // Call the existing function and await its result [6]
    let input = await INPUT(promptMessage);
    
    // Check if input exists, and has non-whitespace characters [1]
    if (input && input.trim().length > 0) {
      return input.trim(); // Return valid input
    }
    
    // Optional: Alert the user to try again
    PRINT("Input cannot be empty. Please try again.",2);
  }
}
async function forceInputNumeric(message) {
    let userInput;
    let number;

    while (true) {
        // Use the existing await INPUT() function
        userInput = await INPUT(message); 
        
        // Try to parse the input to a number
        number = Number(userInput);

        // Check if the input is a valid number and not empty
        if (userInput !== null && userInput.trim() !== "" && !isNaN(number)) {
            return number; // Return valid number and exit loop
        }
        
        // Optional: Alert the user they must enter a number
        PRINT("Invalid input. Please enter a valid number.",2);
    }
}

function RND(min = 1, max = 100) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

// Game variables
let A = 0, B = 0; // scores
let D = 1;        // down
let E = 0;        // yard
let F = 0;        // first down marker
let O = 0;        // offence (1 player, 0 computer)
let T = 0;        // turn counter
let Q = "";

async function main() {
    PRINT("Welcome to AmericanFootball!\n\n");
  let N = RND();

  if (N < 50) {
    PRINT("YOU WON TOSS\n");
    PRINT("[ENTER] TO CONTINUE\n");
    await INPUT();
    O = 1;
  } else {
    PRINT("YOU LOST TOSS\n");
    O = 0;
  }

  await kickoff();
}

async function kickoff() {
  PRINT("KICKOFF\n");
  PRINT("[ENTER] TO CONTINUE\n");
  await INPUT();

  E = RND(1, 30);
  F = E + 10;
  D = 1;

  await menu();
}

async function menu() {
  while (true) {
    if (D === 5) {
      await ballChangeSides();
      continue;
    }

    T++;
    if (T === 120) return gameOver();

    PRINT("Score,YOU,COMP:\n");
    PRINT(`${A} ${B}`);
    await INPUT();

    PRINT("Down,Yard:\n");
    PRINT(`${D} ${E}`);
    await INPUT();

    PRINT("1stDn,Turn of 120:\n");
    PRINT(`${F - E} ${T}`);
    await INPUT();

    if (O === 0) {
      await aiMove();
      continue;
    }

    PRINT("1)LONG PASS 2)SHORT PASS\n");
    PRINT("3)RUN       4)PUNT\n");
    PRINT("5)FIELD GOAL6)INFO\n");

    Q = await forceInputNumeric();

    switch (Q) {
      case 1: await longPass(); break;
      case 2: await shortPass(); break;
      case 3: await run(); break;
      case 4: await punt(); break;
      case 5: await fieldGoal(); break;
      case 6: break;
      default:
        PRINT("INCORRECT INPUT\n");
        await INPUT();
    }
  }
}

async function longPass() {
  PRINT("LONG PASS\n");
  if (RND() < 10) return success();
  return failed();
}

async function shortPass() {
  PRINT("SHORT PASS\n");
  if (RND() < 25) return success();
  return failed();
}

async function run() {
  PRINT("RUN\n");
  if (RND() < 50) return success();
  return failed();
}

async function punt() {
  PRINT("PUNT\n");
  E = RND(1, 50);
  F = E + 10;
  D = 1;
  await ballChangeSides();
}

async function fieldGoal() {
  PRINT("FIELD GOAL\n");
  if (RND() < 50) {
    PRINT("SUCCEEDED\n");
    if (O === 1) A += 2;
    else B += 2;
  } else {
    PRINT("FAILED\n");
  }
  await ballChangeSides();
}

async function failed() {
  PRINT("FAILED\n");
  await INPUT();
  D++;
}

async function success() {
  PRINT("SUCCEEDED\n");
  await INPUT();

  let gain = RND(1, 20);
  E += gain;

  if (E > 99) return touchdown();

  if (E > F) {
    D = 1;
    F = E + 10;
  } else {
    D++;
    if (D > 4) await ballChangeSides();
  }
}

async function touchdown() {
  PRINT("TOUCHDOWN!\n");
  if (O === 1) {
    A += 6;
    A += RND(1);
  } else {
    B += 6;
    B += RND(1);
  }
  await ballChangeSides();
}

async function ballChangeSides() {
  O = O === 1 ? 0 : 1;
  await kickoff();
}

async function aiMove() {
  PRINT("COMPUTER MOVE\n");

  if (D === 4) {
    if (E > 80) return fieldGoal();
    if (E < 60) return punt();
  }

  let r = RND(1, 3);
  if (r === 1) await run();
  else if (r === 2) await shortPass();
  else await longPass();
}

function gameOver() {
  PRINT("GameOver,YOU,COMP:\n");
  PRINT(`${A} ${B}`);
  PRINT(A > B ? "YOU WIN\n" : "COMPUTER WINS\n");
  rl.close();
}

main();

/*
var code = await CURL("https://amjp.psy-k.org/JPLY_BBS/scripts/proxy.php?url=" + encodeURIComponent(
    "https://amjp.psy-k.org/JPLY_BBS/scripts/AmericanFootball.JS_BASIC"
));
await LOAD(code);
*/