async function forceInputAlphaNumeric(promptMessage) {
  while (true) {
    // Call the existing function and await its result [6]
    let input = await INPUT(promptMessage);
    
    // Check if input exists, and has non-whitespace characters [1]
    if (input && input.trim().length > 0) {
      return input.trim(); // Return valid input
    }
    
    // Optional: Alert the user to try again
    PRINT(translate["Input cannot be empty. Please try again."],2);
  }
}
async function forceInputNumeric(message) {
    let userInput;
    let number;

    while (true) {
        // Use the existing await INPUT() function
        userInput = await INPUT(message); 
        
        // Try to parse the input to a number
        number = Number(userInput);

        // Check if the input is a valid number and not empty
        if (userInput !== null && userInput.trim() !== translate[""] && !isNaN(number)) {
            return number; // Return valid number and exit loop
        }
        
        // Optional: Alert the user they must enter a number
        PRINT(translate["Invalid input. Please enter a valid number."],2);
    }
}

function RND(min = 1, max = 100) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

// Game variables
let A = 0, B = 0; // scores
let D = 1;        // down
let E = 0;        // yard
let F = 0;        // first down marker
let O = 0;        // offence (1 player, 0 computer)
let T = 0;        // turn counter
let Q = translate[""];

async function main() {
    PRINT(translate["Welcome to AmericanFootball!\n\n"]);
  let N = RND();

  if (N < 50) {
    PRINT(translate["YOU WON TOSS\n"]);
    PRINT(translate["[ENTER] TO CONTINUE\n"]);
    await INPUT();
    O = 1;
  } else {
    PRINT(translate["YOU LOST TOSS\n"]);
    O = 0;
  }

  await kickoff();
}

async function kickoff() {
  PRINT(translate["KICKOFF\n"]);
  PRINT(translate["[ENTER] TO CONTINUE\n"]);
  await INPUT();

  E = RND(1, 30);
  F = E + 10;
  D = 1;

  await menu();
}

async function menu() {
  while (true) {
    if (D === 5) {
      await ballChangeSides();
      continue;
    }

    T++;
    if (T === 120) return gameOver();

    PRINT(translate["Score,YOU,COMP:\n"]);
    PRINT(`${A} ${B}`);
    await INPUT();

    PRINT(translate["Down,Yard:\n"]);
    PRINT(`${D} ${E}`);
    await INPUT();

    PRINT(translate["1stDn,Turn of 120:\n"]);
    PRINT(`${F - E} ${T}`);
    await INPUT();

    if (O === 0) {
      await aiMove();
      continue;
    }

    PRINT(translate["1)LONG PASS 2)SHORT PASS\n"]);
    PRINT(translate["3)RUN       4)PUNT\n"]);
    PRINT(translate["5)FIELD GOAL6)INFO\n"]);

    Q = await forceInputNumeric();

    switch (Q) {
      case 1: await longPass(); break;
      case 2: await shortPass(); break;
      case 3: await run(); break;
      case 4: await punt(); break;
      case 5: await fieldGoal(); break;
      case 6: break;
      default:
        PRINT(translate["INCORRECT INPUT\n"]);
        await INPUT();
    }
  }
}

async function longPass() {
  PRINT(translate["LONG PASS\n"]);
  if (RND() < 10) return success();
  return failed();
}

async function shortPass() {
  PRINT(translate["SHORT PASS\n"]);
  if (RND() < 25) return success();
  return failed();
}

async function run() {
  PRINT(translate["RUN\n"]);
  if (RND() < 50) return success();
  return failed();
}

async function punt() {
  PRINT(translate["PUNT\n"]);
  E = RND(1, 50);
  F = E + 10;
  D = 1;
  await ballChangeSides();
}

async function fieldGoal() {
  PRINT(translate["FIELD GOAL\n"]);
  if (RND() < 50) {
    PRINT(translate["SUCCEEDED\n"]);
    if (O === 1) A += 2;
    else B += 2;
  } else {
    PRINT(translate["FAILED\n"]);
  }
  await ballChangeSides();
}

async function failed() {
  PRINT(translate["FAILED\n"]);
  await INPUT();
  D++;
}

async function success() {
  PRINT(translate["SUCCEEDED\n"]);
  await INPUT();

  let gain = RND(1, 20);
  E += gain;

  if (E > 99) return touchdown();

  if (E > F) {
    D = 1;
    F = E + 10;
  } else {
    D++;
    if (D > 4) await ballChangeSides();
  }
}

async function touchdown() {
  PRINT(translate["TOUCHDOWN!\n"]);
  if (O === 1) {
    A += 6;
    A += RND(1);
  } else {
    B += 6;
    B += RND(1);
  }
  await ballChangeSides();
}

async function ballChangeSides() {
  O = O === 1 ? 0 : 1;
  await kickoff();
}

async function aiMove() {
  PRINT(translate["COMPUTER MOVE\n"]);

  if (D === 4) {
    if (E > 80) return fieldGoal();
    if (E < 60) return punt();
  }

  let r = RND(1, 3);
  if (r === 1) await run();
  else if (r === 2) await shortPass();
  else await longPass();
}

function gameOver() {
  PRINT(translate["GameOver,YOU,COMP:\n"]);
  PRINT(`${A} ${B}`);
  PRINT(A > B ? translate["YOU WIN\n"] : translate["COMPUTER WINS\n"]);
  rl.close();er();

}

main();

/*
var code = await CURL(translate["https://amjp.psy-k.org/JPLY_BBS/scripts/proxy.php?url="] + encodeURIComponent(
    translate["https://amjp.psy-k.org/JPLY_BBS/scripts/AmericanFootball.JS_BASIC"]
));
await LOAD(code);
*/